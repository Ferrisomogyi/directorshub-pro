<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DirectorsHub Pro v3</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *{font-family:'Inter',sans-serif;box-sizing:border-box}
    body{background:#0a0a0f;color:#fff;margin:0;min-height:100vh}
    .btn{padding:10px 18px;border-radius:10px;font-weight:600;cursor:pointer;transition:all 0.2s;border:none;font-size:13px}
    .btn-red{background:linear-gradient(135deg,#dc2626,#b91c1c);color:#fff}
    .btn-purple{background:linear-gradient(135deg,#8b5cf6,#6d28d9);color:#fff}
    .btn-ghost{background:rgba(255,255,255,0.05);color:#fff;border:1px solid rgba(255,255,255,0.1)}
    .btn-sm{padding:6px 12px;font-size:11px}
    .input{background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);color:#fff;padding:10px 14px;border-radius:10px;width:100%;font-size:13px}
    .input:focus{outline:none;border-color:#dc2626}
    .tab{padding:10px 14px;border-radius:8px;cursor:pointer;transition:all 0.2s;color:rgba(255,255,255,0.6);font-size:11px;white-space:nowrap}
    .tab:hover{background:rgba(255,255,255,0.05)}
    .tab.active{background:rgba(220,38,38,0.2);color:#fff;border-left:3px solid #dc2626}
    .card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:16px}
    .method-card{transition:all 0.3s;cursor:pointer}
    .method-card:hover{transform:translateY(-2px);border-color:rgba(220,38,38,0.5)}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:100;padding:16px}
    .modal-content{background:#1a1a2e;border:1px solid rgba(255,255,255,0.1);border-radius:20px;padding:24px;max-width:600px;width:100%;max-height:85vh;overflow-y:auto}
    .badge{padding:4px 10px;border-radius:20px;font-size:10px;font-weight:600}
    ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:rgba(255,255,255,0.02)}::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:3px}
  </style>
</head>
<body>
<div id="app"></div>
<script>
const S={tab:'dashboard',apiKey:localStorage.getItem('dh_api')||'',project:null,scenes:[],selectedScene:null,actingNotes:[],chatMessages:[],isThinking:false,method:'stanislavski',showSettings:false,showNewProject:false,showMethod:null,showDirector:null,setElements:[],setImage:null,cameraLines:[],drawMode:null,shots:[],storylines:[],breakdown:{}};

// 30 ACTING METHODS
const M={
stanislavski:{n:'Stanislavski System',i:'ğŸ­',c:'Klassiek',f:'K. Stanislavski',d:'Magic If, emotionele waarheid, objectives',t:['Magic If','Given Circumstances','Objectives','Emotion Memory'],col:'#ef4444'},
method:{n:'Method Acting',i:'ğŸ”¥',c:'Klassiek',f:'Lee Strasberg',d:'Emotionele onderdompeling, sense memory',t:['Affective Memory','Sense Memory','Private Moment'],col:'#f97316'},
meisner:{n:'Meisner Technique',i:'ğŸ”„',c:'Klassiek',f:'Sanford Meisner',d:'Living truthfully, repetition exercise',t:['Repetition','Emotional Preparation','Particularization'],col:'#eab308'},
chekhov:{n:'Michael Chekhov',i:'ğŸŒŠ',c:'Klassiek',f:'Michael Chekhov',d:'Psychological Gesture, atmosphere',t:['Psychological Gesture','Atmosphere','Imaginary Body'],col:'#84cc16'},
adler:{n:'Stella Adler',i:'âœ¨',c:'Klassiek',f:'Stella Adler',d:'Verbeelding boven ervaring, script analysis',t:['Script Analysis','Imagination','Size of Action'],col:'#22c55e'},
practical:{n:'Practical Aesthetics',i:'ğŸ¯',c:'Modern',f:'David Mamet',d:'Letterlijk actie, want, essential action',t:['Literal Action','Want','Essential Action','As If'],col:'#14b8a6'},
viewpoints:{n:'Viewpoints',i:'ğŸ‘ï¸',c:'Fysiek',f:'Anne Bogart',d:'Ruimte, tijd, beweging - ensemble approach',t:['Spatial Relationship','Kinesthetic Response','Shape','Tempo'],col:'#06b6d4'},
suzuki:{n:'Suzuki Method',i:'âš¡',c:'Fysiek',f:'Tadashi Suzuki',d:'Extreme fysieke training, grounding',t:['Stomping','Statues','Slow Ten','Walking'],col:'#0ea5e9'},
laban:{n:'Laban Movement',i:'ğŸ’ƒ',c:'Fysiek',f:'Rudolf Laban',d:'Eight Efforts: float, punch, glide, etc',t:['Eight Efforts','Space Harmony','Weight','Flow'],col:'#3b82f6'},
alexander:{n:'Alexander Technique',i:'ğŸ§˜',c:'Fysiek',f:'F.M. Alexander',d:'Postuur, spanning release, primary control',t:['Primary Control','Inhibition','Direction'],col:'#6366f1'},
grotowski:{n:'Grotowski Poor Theatre',i:'ğŸ”®',c:'Experimenteel',f:'Jerzy Grotowski',d:'Via negativa, removing blocks, total act',t:['Via Negativa','Body Memory','Total Act','Impulse'],col:'#8b5cf6'},
brecht:{n:'Brecht/Epic Theatre',i:'ğŸ”',c:'Politiek',f:'Bertolt Brecht',d:'Verfremdungseffekt, gestus, showing vs becoming',t:['Verfremdung','Gestus','Breaking Fourth Wall'],col:'#a855f7'},
artaud:{n:'Theatre of Cruelty',i:'ğŸ’€',c:'Experimenteel',f:'Antonin Artaud',d:'Visceraal, ritueel, primal expression',t:['Cruelty','Double','Plague','Breath'],col:'#d946ef'},
hagen:{n:'Uta Hagen',i:'ğŸ“–',c:'Klassiek',f:'Uta Hagen',d:'Respect for Acting, substitution, specificity',t:['Substitution','Transference','Specificity','Endowment'],col:'#ec4899'},
spolin:{n:'Viola Spolin Improv',i:'ğŸª',c:'Improv',f:'Viola Spolin',d:'Theatre games, spontaneity',t:['Point of Concentration','Who/What/Where','Transformation'],col:'#f43f5e'},
boal:{n:'Theatre of Oppressed',i:'âœŠ',c:'Politiek',f:'Augusto Boal',d:'Forum theatre, sociale verandering',t:['Forum Theatre','Image Theatre','Rainbow of Desire'],col:'#ef4444'},
rasaboxes:{n:'Rasaboxes',i:'ğŸ¨',c:'Eastern',f:'Richard Schechner',d:'8 emoties uit Natyasastra',t:['Eight Rasas','Embodiment','Transitions'],col:'#f97316'},
alba:{n:'Alba Emoting',i:'ğŸ˜¢',c:'Scientific',f:'Susana Bloch',d:'Wetenschappelijk ademhaling voor emoties',t:['Six Basic Emotions','Effector Patterns','Step-Out'],col:'#fbbf24'},
filmacting:{n:'Screen Acting',i:'ğŸ“¹',c:'Camera',f:'Various',d:'Minimalisme voor camera, hitting marks',t:['Less is More','Hitting Marks','Eyelines','Continuity'],col:'#a3e635'},
soapacting:{n:'Soap/Telenovela',i:'ğŸ“º',c:'TV',f:'Various',d:'Snelheid, beschikbaarheid, cliffhangers',t:['Quick Emotional Access','Story Memory','Energy Consistency'],col:'#4ade80'},
voicework:{n:'Voice & Speech',i:'ğŸ—£ï¸',c:'Technical',f:'Linklater/Lessac',d:'Stem, articulatie, resonantie',t:['Breath Support','Resonance','Articulation'],col:'#2dd4bf'},
mask:{n:'Mask Work',i:'ğŸ­',c:'Physical',f:'Jacques Lecoq',d:'Neutral mask, character masks',t:['Neutral Mask','Character Mask','Complicity'],col:'#22d3ee'},
clown:{n:'Clown/Bouffon',i:'ğŸ¤¡',c:'Physical',f:'Jacques Lecoq',d:'Flop, vulnerability, pleasure',t:['Flop','Bide','Pleasure','Red Nose'],col:'#38bdf8'},
commedia:{n:'Commedia dell\'Arte',i:'ğŸª',c:'Classical',f:'Italian Tradition',d:'Stock characters, lazzi, improvisation',t:['Lazzi','Stock Characters','Scenario'],col:'#60a5fa'},
biomechanics:{n:'Meyerhold Biomechanics',i:'âš™ï¸',c:'Russian',f:'Vsevolod Meyerhold',d:'Constructivist, external to internal',t:['Ã‰tude','Otkaz','Posil','Stoika'],col:'#818cf8'},
animal:{n:'Animal Work',i:'ğŸ¾',c:'Character',f:'Various',d:'Observatie dieren voor karakter',t:['Observation','Physicalization','Integration'],col:'#a78bfa'},
hotseating:{n:'Hot Seating',i:'ğŸª‘',c:'Rehearsal',f:'Various',d:'In-character Q&A voor onderzoek',t:['Staying in Character','Backstory','Discovery'],col:'#c084fc'},
actioning:{n:'Actioning',i:'ğŸ¯',c:'British',f:'Max Stafford-Clark',d:'Transitive verbs op elke regel',t:['Transitive Verbs','Beating','Units'],col:'#e879f9'},
sensory:{n:'Sensory Awareness',i:'ğŸ‘ƒ',c:'Technical',f:'Various',d:'Zintuiglijk werk, details, texture',t:['Sense Memory','Personal Objects','Place'],col:'#f472b6'},
dreamwork:{n:'Dream/Archetype Work',i:'ğŸŒ™',c:'Jungian',f:'Various',d:'Archetypen, collectief onbewuste',t:['Archetypes','Active Imagination','Shadow Work'],col:'#fb7185'}
};

// 42 DIRECTORS
const D=[
{n:'Steven Spielberg',f:'ğŸ‡ºğŸ‡¸',t:'Close-up van verwondering',c:'Emotie',m:'E.T., Jaws, Schindler\'s List',cat:'Hollywood'},
{n:'Martin Scorsese',f:'ğŸ‡ºğŸ‡¸',t:'Freeze frames, muziek als personage',c:'Karakter',m:'Goodfellas, Taxi Driver',cat:'Hollywood'},
{n:'David Fincher',f:'ğŸ‡ºğŸ‡¸',t:'40+ takes voor perfectie',c:'Precisie',m:'Fight Club, Se7en, Gone Girl',cat:'Hollywood'},
{n:'Quentin Tarantino',f:'ğŸ‡ºğŸ‡¸',t:'Dialoog IS actie, trunk shots',c:'Dialoog',m:'Pulp Fiction, Kill Bill',cat:'Hollywood'},
{n:'Christopher Nolan',f:'ğŸ‡¬ğŸ‡§',t:'Tijdsmanipulatie, practical effects',c:'Concept',m:'Inception, Oppenheimer',cat:'Hollywood'},
{n:'Denis Villeneuve',f:'ğŸ‡¨ğŸ‡¦',t:'Stilte is krachtig, langzame build',c:'Sfeer',m:'Dune, Arrival, BR2049',cat:'Hollywood'},
{n:'Stanley Kubrick',f:'ğŸ‡ºğŸ‡¸',t:'Symmetrie, 100+ takes',c:'Visueel',m:'The Shining, 2001',cat:'Hollywood'},
{n:'Alfred Hitchcock',f:'ğŸ‡¬ğŸ‡§',t:'Suspense â‰  Surprise, MacGuffin',c:'Suspense',m:'Psycho, Vertigo',cat:'Hollywood'},
{n:'Francis Ford Coppola',f:'ğŸ‡ºğŸ‡¸',t:'Epische scope, familiedrama',c:'Episch',m:'The Godfather',cat:'Hollywood'},
{n:'Ridley Scott',f:'ğŸ‡¬ğŸ‡§',t:'Visuele wereldbouw',c:'Visueel',m:'Blade Runner, Gladiator',cat:'Hollywood'},
{n:'Greta Gerwig',f:'ğŸ‡ºğŸ‡¸',t:'Naturalistisch, improv-friendly',c:'Indie',m:'Lady Bird, Barbie',cat:'Hollywood'},
{n:'Jordan Peele',f:'ğŸ‡ºğŸ‡¸',t:'Sociaal commentaar via horror',c:'Horror',m:'Get Out, Us, Nope',cat:'Hollywood'},
{n:'Wes Anderson',f:'ğŸ‡ºğŸ‡¸',t:'Symmetrie, kleurenpalet',c:'Stijl',m:'Grand Budapest Hotel',cat:'Hollywood'},
{n:'Coen Brothers',f:'ğŸ‡ºğŸ‡¸',t:'Dark comedy, nihilisme',c:'Dialoog',m:'Fargo, No Country',cat:'Hollywood'},
{n:'Paul Thomas Anderson',f:'ğŸ‡ºğŸ‡¸',t:'Long takes, ensemble',c:'Drama',m:'There Will Be Blood',cat:'Hollywood'},
{n:'Akira Kurosawa',f:'ğŸ‡¯ğŸ‡µ',t:'Weer als personage, wipes',c:'Episch',m:'Seven Samurai',cat:'International'},
{n:'Bong Joon-ho',f:'ğŸ‡°ğŸ‡·',t:'Genre-mixing, sociale satire',c:'Satire',m:'Parasite',cat:'International'},
{n:'Park Chan-wook',f:'ğŸ‡°ğŸ‡·',t:'Extreme close-ups, revenge',c:'Thriller',m:'Oldboy',cat:'International'},
{n:'Wong Kar-wai',f:'ğŸ‡­ğŸ‡°',t:'Mood over plot, step-printing',c:'Romance',m:'In the Mood for Love',cat:'International'},
{n:'Pedro AlmodÃ³var',f:'ğŸ‡ªğŸ‡¸',t:'Melodrama, kleur',c:'Drama',m:'All About My Mother',cat:'International'},
{n:'Guillermo del Toro',f:'ğŸ‡²ğŸ‡½',t:'Fairytale horror, practical',c:'Fantasy',m:'Pan\'s Labyrinth',cat:'International'},
{n:'Alfonso CuarÃ³n',f:'ğŸ‡²ğŸ‡½',t:'Long takes, immersive camera',c:'Drama',m:'Roma, Gravity',cat:'International'},
{n:'Lars von Trier',f:'ğŸ‡©ğŸ‡°',t:'Dogme 95, provocation',c:'Art',m:'Melancholia',cat:'International'},
{n:'Ingmar Bergman',f:'ğŸ‡¸ğŸ‡ª',t:'Close-ups gezichten, existentieel',c:'Drama',m:'Persona',cat:'International'},
{n:'Federico Fellini',f:'ğŸ‡®ğŸ‡¹',t:'Surrealistisch, autobiografisch',c:'Art',m:'8Â½, La Dolce Vita',cat:'International'},
{n:'Vince Gilligan',f:'ğŸ‡ºğŸ‡¸',t:'Visual storytelling, time-lapse',c:'TV Drama',m:'Breaking Bad',cat:'TV'},
{n:'David Chase',f:'ğŸ‡ºğŸ‡¸',t:'AmbiguÃ¯teit, droomsequenties',c:'TV Drama',m:'The Sopranos',cat:'TV'},
{n:'Shonda Rhimes',f:'ğŸ‡ºğŸ‡¸',t:'Snelle dialoog, cliffhangers',c:'TV Drama',m:'Grey\'s Anatomy',cat:'TV'},
{n:'Ryan Murphy',f:'ğŸ‡ºğŸ‡¸',t:'Camp, horror, antologie',c:'TV Drama',m:'AHS, Glee',cat:'TV'},
{n:'Ava DuVernay',f:'ğŸ‡ºğŸ‡¸',t:'Social justice, intimiteit',c:'TV/Film',m:'When They See Us',cat:'TV'},
{n:'Mike Flanagan',f:'ğŸ‡ºğŸ‡¸',t:'Long takes, family trauma',c:'Horror TV',m:'Hill House',cat:'TV'},
{n:'Paul Verhoeven',f:'ğŸ‡³ğŸ‡±',t:'Provocatie, satire, geweld als commentaar',c:'Dutch',m:'Turks Fruit, Zwartboek',cat:'Dutch'},
{n:'Alex van Warmerdam',f:'ğŸ‡³ğŸ‡±',t:'Absurdisme, zwarte humor',c:'Dutch',m:'Borgman',cat:'Dutch'},
{n:'Martin Koolhoven',f:'ğŸ‡³ğŸ‡±',t:'Genre film, western',c:'Dutch',m:'Brimstone',cat:'Dutch'},
{n:'Johan Nijenhuis',f:'ğŸ‡³ğŸ‡±',t:'Commercieel, romantisch',c:'Dutch',m:'Alles is Liefde',cat:'Dutch'},
{n:'Joram LÃ¼rsen',f:'ğŸ‡³ğŸ‡±',t:'Thriller, drama',c:'Dutch',m:'De Heineken Ontvoering',cat:'Dutch'},
{n:'Paula van der Oest',f:'ğŸ‡³ğŸ‡±',t:'Vrouwelijke perspectief',c:'Dutch',m:'Zus & Zo, Tonio',cat:'Dutch'},
{n:'Pieter Kuijpers',f:'ğŸ‡³ğŸ‡±',t:'Crime, Nederlandse noir',c:'Dutch',m:'TBS, Van God Los',cat:'Dutch'},
{n:'Soap Multi-Camera',f:'ğŸ“º',t:'180 regel, coverage, efficiency',c:'Soap',m:'GTST, BTOB',cat:'Soap'},
{n:'Telenovela Style',f:'ğŸ“º',t:'Close-ups emotie, cliffhangers',c:'Soap',m:'Latin soaps',cat:'Soap'},
{n:'British Soap',f:'ğŸ‡¬ğŸ‡§',t:'Realisme, social issues',c:'Soap',m:'EastEnders',cat:'Soap'},
{n:'Nordic Noir',f:'ğŸ‡¸ğŸ‡ª',t:'Koud licht, morele ambiguÃ¯teit',c:'TV',m:'The Bridge',cat:'TV'}
];

const BREAKDOWN={cast:{n:'Cast',c:'#dc2626',i:'ğŸ‘¤'},extras:{n:'Figuranten',c:'#22c55e',i:'ğŸ‘¥'},stunts:{n:'Stunts',c:'#f97316',i:'ğŸ¤¸'},vehicles:{n:'Voertuigen',c:'#eab308',i:'ğŸš—'},props:{n:'Props',c:'#a855f7',i:'ğŸ­'},wardrobe:{n:'Kostuum',c:'#ec4899',i:'ğŸ‘—'},makeup:{n:'Make-up',c:'#06b6d4',i:'ğŸ’„'},sfx:{n:'SFX',c:'#3b82f6',i:'ğŸ’¥'},animals:{n:'Dieren',c:'#84cc16',i:'ğŸ•'},music:{n:'Muziek',c:'#f43f5e',i:'ğŸµ'}};
const SHOTS=['ECU','CU','MCU','MS','MLS','LS','ELS','OTS','POV','2-Shot','Group','Insert','Aerial'];
const ANGLES=['Eye Level','High Angle','Low Angle','Dutch','Bird\'s Eye','Worm\'s Eye'];
const MOVES=['Static','Pan','Tilt','Dolly','Track','Crane','Steadicam','Handheld','Zoom'];

const id=()=>Math.random().toString(36).substr(2,9);
const save=()=>localStorage.setItem('dh_api',S.apiKey);

const ai=async(p,c='')=>{
  if(!S.apiKey)return'âš ï¸ Voeg API key toe via âš™ï¸';
  try{const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','x-api-key':S.apiKey,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:4096,system:'Je bent een ervaren regisseur. Nederlands, praktisch.',messages:[{role:'user',content:c?c+'\n\n'+p:p}]})});
  const d=await r.json();return d.content?.[0]?.text||'Geen antwoord';}catch(e){return'Fout: '+e.message}
};

const parse=txt=>{
  // Simpel: maak 1 scene van het hele script
  // De gebruiker kan later zelf scenes splitsen indien gewenst
  const clean = txt.replace(/\*/g, ' ').replace(/\s+/g, ' ').trim();
  if(!clean) return [];
  
  return [{
    id: id(),
    num: 1,
    h: 'Volledig Script',
    loc: 'Script',
    tod: '',
    ie: 'INT',
    chars: [],
    lines: txt.split(/[\n\r]+/).filter(l=>l.trim()),
    txt: txt,
    breakdown: {}
  }];
};

const render=()=>{
  document.getElementById('app').innerHTML=`
    <div style="display:flex;min-height:100vh">
      <nav style="width:170px;background:rgba(255,255,255,0.02);border-right:1px solid rgba(255,255,255,0.05);padding:12px;flex-shrink:0;overflow-y:auto">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:20px">
          <div style="width:32px;height:32px;background:linear-gradient(135deg,#dc2626,#991b1b);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px">ğŸ¬</div>
          <div><div style="font-weight:700;font-size:13px">DirectorsHub</div><div style="font-size:10px;opacity:0.5">Pro v3</div></div>
        </div>
        <div style="display:flex;flex-direction:column;gap:3px">
          ${['dashboard|ğŸ“Š|Dashboard','scripts|ğŸ“œ|Scripts','breakdown|ğŸ·ï¸|Breakdown','decoupage|ğŸ¥|Decoupage','shots|ğŸ“‹|Shot List','acting|ğŸ­|Acting','methods|ğŸ“š|Methodes','directors|ğŸ¬|Regisseurs','setplan|ğŸ—ºï¸|Set Plan','storylines|ğŸ“ˆ|Lijnen','schedule|ğŸ“…|Draaiboek','chat|ğŸ’¬|AI Chat'].map(x=>{const[k,i,l]=x.split('|');return'<div class="tab '+(S.tab===k?'active':'')+'" onclick="S.tab=\''+k+'\';render()">'+i+' '+l+'</div>';}).join('')}
        </div>
        <div style="margin-top:16px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.05);font-size:10px;opacity:0.5">
          ${Object.keys(M).length} methodes<br>${D.length} regisseurs<br>${S.scenes.length} scenes
        </div>
      </nav>
      <main style="flex:1;padding:20px;overflow-y:auto;max-height:100vh">
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-bottom:12px">
          ${S.apiKey?'<span style="font-size:11px;color:#22c55e;padding:6px 12px;background:rgba(34,197,94,0.1);border-radius:20px">ğŸŸ¢ AI</span>':'<span style="font-size:11px;color:#ef4444;padding:6px 12px;background:rgba(239,68,68,0.1);border-radius:20px">ğŸ”´ API</span>'}
          <button class="btn btn-ghost btn-sm" onclick="S.showNewProject=true;render()">â•</button>
          <button class="btn btn-ghost btn-sm" onclick="S.showSettings=true;render()">âš™ï¸</button>
        </div>
        ${renderTab()}
      </main>
    </div>
    ${S.showSettings?renderSettings():''}
    ${S.showNewProject?renderNewProject():''}
    ${S.showMethod?renderMethodModal():''}
    ${S.showDirector!==null?renderDirectorModal():''}
  `;
  if(S.tab==='setplan')setTimeout(initCanvas,50);
};

const renderTab=()=>({dashboard:renderDash,scripts:renderScripts,breakdown:renderBreakdown,decoupage:renderDecoupage,shots:renderShots,acting:renderActing,methods:renderMethods,directors:renderDirs,setplan:renderSet,storylines:renderStorylines,schedule:renderSchedule,chat:renderChat}[S.tab]||renderDash)();

const renderDash=()=>!S.project?`
  <div class="card" style="max-width:700px;margin:40px auto;text-align:center;background:linear-gradient(135deg,#1a1a2e,#16213e)">
    <div style="font-size:56px;margin-bottom:12px">ğŸ¬</div>
    <h1 style="margin:0 0 4px;font-size:28px">DirectorsHub Pro v3</h1>
    <p style="opacity:0.6;margin-bottom:20px;font-size:14px">${Object.keys(M).length} methodes â€¢ ${D.length} regisseurs â€¢ Complete toolkit</p>
    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
      <button class="btn btn-red" onclick="S.showNewProject=true;render()">ğŸ¬ Nieuw Project</button>
      <button class="btn btn-ghost" onclick="S.tab='methods';render()">ğŸ“š Methodes</button>
      <button class="btn btn-ghost" onclick="S.tab='directors';render()">ğŸ¬ Regisseurs</button>
    </div>
  </div>
`:`<h1 style="margin:0 0 16px">${S.project.name}</h1>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:12px">
${[['ğŸ“œ',S.scenes.length,'Scenes'],['ğŸ‘¥',[...new Set(S.scenes.flatMap(s=>s.chars))].length,'Karakters'],['ğŸ¥',S.shots.length,'Shots'],['ğŸ“ˆ',S.storylines.length,'Lijnen'],['ğŸ—ºï¸',S.setElements.length,'Set Els'],['ğŸ­',Object.keys(M).length,'Methodes']].map(([i,n,l])=>'<div class="card"><div style="font-size:20px">'+i+'</div><div style="font-size:24px;font-weight:700">'+n+'</div><div style="font-size:11px;opacity:0.5">'+l+'</div></div>').join('')}
</div>`;

const renderScripts=()=>`
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px"><h1 style="margin:0">Scripts</h1>
<button class="btn btn-red btn-sm" onclick="uploadScript()">ğŸ“¤ Upload</button></div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
<div class="card"><h3 style="margin:0 0 12px;font-size:14px">Upload</h3>
<div style="border:2px dashed rgba(255,255,255,0.1);padding:24px;text-align:center;border-radius:10px;cursor:pointer" onclick="uploadScript()"><div style="font-size:32px;margin-bottom:8px">ğŸ“„</div><div style="font-size:12px;opacity:0.6">.txt/.docx</div></div>
<textarea id="scriptTxt" class="input" style="height:80px;margin-top:12px;resize:none;font-size:12px" placeholder="Of plak tekst..."></textarea>
<button class="btn btn-ghost" style="width:100%;margin-top:8px" onclick="parseTxt()">ğŸ“Š Analyseer</button></div>
<div class="card"><h3 style="margin:0 0 12px;font-size:14px">Scenes (${S.scenes.length})</h3>
<div style="max-height:280px;overflow-y:auto">${S.scenes.map(s=>'<div style="padding:10px;background:rgba(255,255,255,0.03);border-radius:8px;margin-bottom:6px;cursor:pointer;border:2px solid '+(S.selectedScene?.id===s.id?'#dc2626':'transparent')+';font-size:12px" onclick="S.selectedScene=S.scenes.find(x=>x.id===\''+s.id+'\');render()"><div style="display:flex;justify-content:space-between"><span><strong style="color:#ef4444">'+s.num+'</strong> '+s.loc+'</span><span style="opacity:0.5;font-size:10px">'+s.ie+' '+s.tod+'</span></div><div style="font-size:10px;opacity:0.5;margin-top:4px">'+s.chars.slice(0,3).join(', ')+'</div></div>').join('')||'<p style="opacity:0.5;text-align:center;font-size:12px">Upload script</p>'}</div></div></div>
${S.selectedScene?'<div class="card" style="margin-top:16px"><div style="display:flex;justify-content:space-between;margin-bottom:12px"><h3 style="margin:0;font-size:14px">Scene '+S.selectedScene.num+': '+S.selectedScene.loc+'</h3><div style="display:flex;gap:6px"><button class="btn btn-purple btn-sm" onclick="aiScene()">ğŸ¤– Analyse</button><button class="btn btn-ghost btn-sm" onclick="S.tab=\'breakdown\';render()">ğŸ·ï¸ Breakdown</button></div></div><pre style="background:rgba(0,0,0,0.3);padding:12px;border-radius:8px;font-size:11px;max-height:200px;overflow-y:auto;white-space:pre-wrap">'+S.selectedScene.txt+'</pre></div>':''}`;

const renderBreakdown=()=>`<h1 style="margin:0 0 16px">Breakdown</h1>
<div style="display:grid;grid-template-columns:180px 1fr;gap:16px">
<div><div class="card" style="margin-bottom:12px"><h4 style="margin:0 0 12px;font-size:12px">CategorieÃ«n</h4>
${Object.entries(BREAKDOWN).map(([k,v])=>'<div style="display:flex;align-items:center;gap:8px;padding:6px;margin-bottom:4px;border-radius:6px;cursor:pointer;background:rgba(255,255,255,0.03)" onclick="addBreakdownItem(\''+k+'\')"><span style="width:18px;height:18px;background:'+v.c+';border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:9px">'+v.i+'</span><span style="font-size:11px">'+v.n+'</span></div>').join('')}
</div><button class="btn btn-purple btn-sm" style="width:100%" onclick="aiBreakdown()">ğŸ¤– Auto</button></div>
<div class="card">${S.selectedScene?'<h3 style="margin:0 0 12px;font-size:14px">Scene '+S.selectedScene.num+'</h3><div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px">'+Object.entries(S.selectedScene.breakdown||{}).flatMap(([cat,items])=>items.map(item=>'<span class="badge" style="background:'+(BREAKDOWN[cat]?.c||'#666')+'">'+item+'</span>')).join('')+'</div><pre style="background:rgba(0,0,0,0.3);padding:12px;border-radius:8px;font-size:11px;max-height:250px;overflow-y:auto;white-space:pre-wrap">'+S.selectedScene.txt+'</pre>':'<div style="text-align:center;padding:40px;opacity:0.5"><div style="font-size:32px">ğŸ·ï¸</div><p style="font-size:12px">Selecteer scene in Scripts</p></div>'}</div></div>`;

const renderDecoupage=()=>`<h1 style="margin:0 0 16px">Decoupage</h1>
<div style="display:grid;grid-template-columns:220px 1fr;gap:16px">
<div><div class="card" style="margin-bottom:12px"><h4 style="margin:0 0 10px;font-size:12px">Shot</h4>
<select id="shotSize" class="input" style="margin-bottom:8px;font-size:11px">${SHOTS.map(s=>'<option>'+s+'</option>').join('')}</select>
<select id="shotAngle" class="input" style="margin-bottom:8px;font-size:11px">${ANGLES.map(a=>'<option>'+a+'</option>').join('')}</select>
<select id="shotMove" class="input" style="margin-bottom:8px;font-size:11px">${MOVES.map(m=>'<option>'+m+'</option>').join('')}</select>
<input id="shotDesc" class="input" placeholder="Beschrijving..." style="margin-bottom:8px;font-size:11px">
<button class="btn btn-red btn-sm" style="width:100%" onclick="addShot()">â• Shot</button></div>
<button class="btn btn-purple btn-sm" style="width:100%" onclick="aiDecoupage()">ğŸ¤– AI Decoupage</button></div>
<div class="card"><h3 style="margin:0 0 12px;font-size:14px">Shots ${S.selectedScene?'Scene '+S.selectedScene.num:''}</h3>
<div style="max-height:350px;overflow-y:auto">${S.shots.filter(sh=>!S.selectedScene||sh.sceneId===S.selectedScene.id).map((sh,i)=>'<div style="display:flex;gap:12px;padding:10px;background:rgba(255,255,255,0.03);border-radius:8px;margin-bottom:6px;align-items:center"><div style="width:28px;height:28px;background:#dc2626;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:11px">'+(i+1)+'</div><div style="flex:1"><div style="font-weight:600;font-size:12px">'+sh.size+' - '+sh.angle+'</div><div style="font-size:11px;opacity:0.6">'+sh.move+(sh.desc?' â€¢ '+sh.desc:'')+'</div></div><button class="btn btn-ghost btn-sm" onclick="removeShot('+i+')">âœ•</button></div>').join('')||'<p style="opacity:0.5;text-align:center;font-size:12px">Geen shots</p>'}</div></div></div>`;

const renderShots=()=>`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px"><h1 style="margin:0">Shot List</h1><div style="display:flex;gap:8px"><button class="btn btn-purple btn-sm" onclick="aiShotlist()">ğŸ¤– Gen</button><button class="btn btn-ghost btn-sm" onclick="exportShots()">ğŸ“¤</button></div></div>
<div class="card"><table style="width:100%;border-collapse:collapse;font-size:12px"><thead><tr style="border-bottom:1px solid rgba(255,255,255,0.1)"><th style="text-align:left;padding:10px">#</th><th style="text-align:left;padding:10px">Scene</th><th style="text-align:left;padding:10px">Size</th><th style="text-align:left;padding:10px">Angle</th><th style="text-align:left;padding:10px">Move</th><th style="text-align:left;padding:10px">Desc</th><th></th></tr></thead>
<tbody>${S.shots.map((sh,i)=>{const sc=S.scenes.find(s=>s.id===sh.sceneId);return'<tr style="border-bottom:1px solid rgba(255,255,255,0.05)"><td style="padding:10px;font-weight:700;color:#dc2626">'+(i+1)+'</td><td style="padding:10px">'+(sc?sc.num:'-')+'</td><td style="padding:10px"><span style="background:rgba(220,38,38,0.2);padding:2px 8px;border-radius:4px">'+sh.size+'</span></td><td style="padding:10px">'+sh.angle+'</td><td style="padding:10px">'+sh.move+'</td><td style="padding:10px;opacity:0.7">'+(sh.desc||'-')+'</td><td style="padding:10px"><button class="btn btn-ghost btn-sm" onclick="removeShot('+i+')">âœ•</button></td></tr>'}).join('')||'<tr><td colspan="7" style="padding:20px;text-align:center;opacity:0.5">Geen shots</td></tr>'}</tbody></table></div>`;

const renderActing=()=>`<h1 style="margin:0 0 16px">Acting</h1>
<div style="display:grid;grid-template-columns:200px 1fr;gap:16px">
<div class="card"><h4 style="margin:0 0 10px;font-size:12px">Methode</h4><div style="max-height:280px;overflow-y:auto">${Object.entries(M).map(([k,m])=>'<div style="padding:8px;background:'+(S.method===k?'rgba(220,38,38,0.2)':'rgba(255,255,255,0.03)')+';border-radius:6px;margin-bottom:4px;cursor:pointer;font-size:11px;border-left:3px solid '+(S.method===k?m.col:'transparent')+'" onclick="S.method=\''+k+'\';render()">'+m.i+' '+m.n+'</div>').join('')}</div></div>
<div class="card"><h3 style="margin:0 0 12px;font-size:14px">Genereer</h3>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px">
<select id="aScene" class="input" style="font-size:12px"><option value="">Scene...</option>${S.scenes.map(s=>'<option value="'+s.id+'">'+s.num+'. '+s.loc+'</option>').join('')}</select>
<select id="aChar" class="input" style="font-size:12px"><option value="">Karakter...</option>${[...new Set(S.scenes.flatMap(s=>s.chars))].map(c=>'<option value="'+c+'">'+c+'</option>').join('')}</select></div>
<div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;margin-bottom:12px;border-left:3px solid ${M[S.method].col}"><div style="font-weight:600;font-size:13px">${M[S.method].i} ${M[S.method].n}</div><div style="font-size:11px;opacity:0.6;margin-top:4px">${M[S.method].d}</div></div>
<button class="btn btn-purple" style="width:100%" onclick="genActing()">ğŸ¤– Genereer</button>
${S.actingNotes.length?'<h4 style="margin:20px 0 12px;font-size:12px">Recent</h4>'+S.actingNotes.slice(-2).reverse().map(n=>'<div style="background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;margin-bottom:8px;font-size:12px"><strong>'+n.char+'</strong> <span style="opacity:0.5;font-size:10px">'+n.method+'</span><div style="opacity:0.8;white-space:pre-wrap;font-size:11px;max-height:80px;overflow-y:auto;margin-top:6px">'+n.content+'</div></div>').join(''):''}</div></div>`;

const renderMethods=()=>{const cats=[...new Set(Object.values(M).map(m=>m.c))];
return'<h1 style="margin:0 0 16px">'+Object.keys(M).length+' Methodes</h1>'+cats.map(cat=>'<h3 style="margin:16px 0 10px;font-size:12px;opacity:0.6">'+cat+'</h3><div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px">'+Object.entries(M).filter(([k,m])=>m.c===cat).map(([k,m])=>'<div class="card method-card" style="padding:12px;border-left:3px solid '+m.col+'" onclick="S.showMethod=\''+k+'\';render()"><div style="font-size:18px;margin-bottom:4px">'+m.i+'</div><div style="font-weight:600;font-size:11px">'+m.n+'</div><div style="font-size:9px;opacity:0.5;margin-top:2px">'+m.f+'</div></div>').join('')+'</div>').join('');};

const renderMethodModal=()=>{const m=M[S.showMethod];if(!m)return'';
return'<div class="modal" onclick="S.showMethod=null;render()"><div class="modal-content" onclick="event.stopPropagation()"><div style="display:flex;justify-content:space-between;margin-bottom:16px"><div style="display:flex;gap:12px;align-items:center"><span style="font-size:36px">'+m.i+'</span><div><h2 style="margin:0;font-size:18px">'+m.n+'</h2><p style="opacity:0.5;margin:4px 0 0;font-size:12px">'+m.f+'</p></div></div><button class="btn btn-ghost btn-sm" onclick="S.showMethod=null;render()">âœ•</button></div><p style="font-size:13px">'+m.d+'</p><div style="background:rgba(255,255,255,0.05);padding:12px;border-radius:10px;margin:12px 0"><strong style="font-size:12px">Technieken:</strong><div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:8px">'+m.t.map(t=>'<span style="background:'+m.col+';padding:4px 10px;border-radius:20px;font-size:10px">'+t+'</span>').join('')+'</div></div><div style="display:flex;gap:8px"><button class="btn btn-red" style="flex:1" onclick="S.method=\''+S.showMethod+'\';S.showMethod=null;S.tab=\'acting\';render()">ğŸ­ Gebruik</button><button class="btn btn-purple" onclick="aiMethodDeep(\''+S.showMethod+'\')">ğŸ¤– Meer</button></div></div></div>';};

const renderDirs=()=>{const cats=[...new Set(D.map(d=>d.cat))];
return'<h1 style="margin:0 0 16px">'+D.length+' Regisseurs</h1>'+cats.map(cat=>'<h3 style="margin:16px 0 10px;font-size:12px;opacity:0.6">'+cat+'</h3><div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px">'+D.filter(d=>d.cat===cat).map((d,i)=>'<div class="card method-card" style="padding:12px" onclick="S.showDirector='+D.indexOf(d)+';render()"><div style="display:flex;gap:10px;align-items:center;margin-bottom:6px"><span style="font-size:18px">'+d.f+'</span><div><div style="font-weight:600;font-size:11px">'+d.n+'</div><div style="font-size:9px;opacity:0.5">'+d.c+'</div></div></div><p style="font-size:10px;opacity:0.6;margin:0">"'+d.t.substring(0,50)+'..."</p></div>').join('')+'</div>').join('');};

const renderDirectorModal=()=>{const d=D[S.showDirector];if(!d)return'';
return'<div class="modal" onclick="S.showDirector=null;render()"><div class="modal-content" onclick="event.stopPropagation()"><div style="display:flex;justify-content:space-between;margin-bottom:16px"><div style="display:flex;gap:12px;align-items:center"><span style="font-size:36px">'+d.f+'</span><div><h2 style="margin:0;font-size:18px">'+d.n+'</h2><p style="opacity:0.5;margin:4px 0 0;font-size:12px">'+d.cat+'</p></div></div><button class="btn btn-ghost btn-sm" onclick="S.showDirector=null;render()">âœ•</button></div><div style="background:rgba(245,158,11,0.1);padding:14px;border-radius:10px;margin-bottom:12px"><strong style="color:#f59e0b;font-size:12px">ğŸ’¡ Signature</strong><p style="margin:8px 0 0;font-size:14px">"'+d.t+'"</p></div><p style="font-size:12px"><strong>Werken:</strong> '+d.m+'</p><div style="display:flex;gap:8px;margin-top:16px"><button class="btn btn-purple" style="flex:1" onclick="deepDir(\''+d.n+'\')">ğŸ¤– Deep Dive</button><button class="btn btn-ghost" onclick="S.showDirector=null;render()">Sluiten</button></div></div></div>';};

const renderSet=()=>`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:8px"><h1 style="margin:0">Set Planning</h1>
<div style="display:flex;gap:8px;flex-wrap:wrap"><button class="btn btn-ghost btn-sm" onclick="document.getElementById('setImgIn').click()">ğŸ–¼ï¸ Plattegrond</button><input type="file" id="setImgIn" style="display:none" accept="image/*" onchange="loadImg(event)"><button class="btn btn-ghost btn-sm" onclick="clearSet()">ğŸ—‘ï¸</button><button class="btn btn-purple btn-sm" onclick="aiBlocking()">ğŸ¤– Tips</button></div></div>
<div style="display:grid;grid-template-columns:150px 1fr;gap:12px">
<div><div class="card" style="margin-bottom:10px;padding:12px"><h4 style="margin:0 0 8px;font-size:11px">Elementen</h4>
${['actor|ğŸ‘¤|#ef4444|Actor','camera|ğŸ“¹|#3b82f6|Camera','light|ğŸ’¡|#eab308|Licht','prop|ğŸª‘|#22c55e|Prop','mark|âœ–ï¸|#a855f7|Mark'].map(x=>{const[t,i,c,l]=x.split('|');return'<button class="btn btn-ghost btn-sm" style="width:100%;margin-bottom:4px;justify-content:flex-start;display:flex;align-items:center;gap:6px;padding:8px" onclick="addEl(\''+t+'\')"><span style="width:14px;height:14px;background:'+c+';border-radius:50%;font-size:8px;display:flex;align-items:center;justify-content:center">'+i+'</span>'+l+'</button>';}).join('')}</div>
<div class="card" style="margin-bottom:10px;padding:12px"><h4 style="margin:0 0 8px;font-size:11px">Tekenen</h4>
<button class="btn ${S.drawMode==='line'?'btn-red':'btn-ghost'} btn-sm" style="width:100%;margin-bottom:4px" onclick="setDraw('line')">ğŸ“ Kijklijn</button>
<button class="btn ${S.drawMode==='move'?'btn-red':'btn-ghost'} btn-sm" style="width:100%;margin-bottom:4px" onclick="setDraw('move')">â¡ï¸ Beweging</button>
<button class="btn btn-ghost btn-sm" style="width:100%" onclick="undoLine()">â†©ï¸ Undo</button></div>
<div class="card" style="padding:12px"><h4 style="margin:0 0 8px;font-size:11px">Patterns</h4>
${['triangle|ğŸ”º|Driehoek','diagonal|â†—ï¸|Diagonaal','ots|ğŸ¬|OTS'].map(x=>{const[p,i,l]=x.split('|');return'<div style="padding:6px;background:rgba(255,255,255,0.03);border-radius:6px;margin-bottom:4px;cursor:pointer;font-size:10px" onclick="pattern(\''+p+'\')">'+i+' '+l+'</div>';}).join('')}</div></div>
<div class="card" style="padding:0;overflow:hidden"><canvas id="setCanvas" width="700" height="450" style="display:block;width:100%;cursor:crosshair;background:#1a1a2e"></canvas>
<div style="padding:8px 12px;font-size:10px;opacity:0.6;background:rgba(0,0,0,0.2)">${S.setElements.length} els â€¢ ${S.cameraLines.length} lijnen ${S.drawMode?'â€¢ <span style="color:#ef4444">'+S.drawMode+'</span>':''}</div></div></div>
${S.setElements.length?'<div class="card" style="margin-top:12px;padding:12px"><div style="display:flex;flex-wrap:wrap;gap:6px">'+S.setElements.map((e,i)=>'<span style="padding:4px 10px;background:rgba(255,255,255,0.05);border-radius:20px;font-size:10px;display:flex;align-items:center;gap:6px"><span style="width:10px;height:10px;background:'+(e.type==='actor'?'#ef4444':e.type==='camera'?'#3b82f6':e.type==='light'?'#eab308':e.type==='prop'?'#22c55e':'#a855f7')+';border-radius:50%"></span>'+e.name+'<span style="cursor:pointer;opacity:0.5" onclick="remEl('+i+')">âœ•</span></span>').join('')+'</div></div>':''}`;

const renderStorylines=()=>`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px"><h1 style="margin:0">Verhaallijnen</h1>
<div style="display:flex;gap:8px"><button class="btn btn-red btn-sm" onclick="addStoryline()">â• Lijn</button><button class="btn btn-purple btn-sm" onclick="aiStorylines()">ğŸ¤– Analyse</button></div></div>
<div class="card">${S.storylines.length?'<div style="display:flex;flex-direction:column;gap:10px">'+S.storylines.map((sl,i)=>'<div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:10px;border-left:4px solid '+sl.color+'"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><strong style="font-size:13px">'+sl.name+'</strong><div style="display:flex;gap:4px"><span class="badge" style="background:'+(sl.priority==='A'?'#dc2626':sl.priority==='B'?'#f59e0b':'#6b7280')+'">'+sl.priority+'-lijn</span><button class="btn btn-ghost btn-sm" onclick="removeStoryline('+i+')">âœ•</button></div></div><p style="font-size:12px;opacity:0.7;margin:0">'+(sl.desc||'Geen beschrijving')+'</p></div>').join('')+'</div>':'<div style="text-align:center;padding:40px;opacity:0.5"><div style="font-size:32px">ğŸ“ˆ</div><p style="font-size:12px">Nog geen verhaallijnen</p><button class="btn btn-red btn-sm" style="margin-top:12px" onclick="addStoryline()">â• Eerste</button></div>'}</div>`;

const renderSchedule=()=>`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px"><h1 style="margin:0">Draaiboek</h1>
<div style="display:flex;gap:8px"><button class="btn btn-purple btn-sm" onclick="aiSchedule()">ğŸ¤– Optimaliseer</button><button class="btn btn-ghost btn-sm" onclick="exportSchedule()">ğŸ“¤</button></div></div>
<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px">
${[['ğŸ“œ',S.scenes.length,'Scenes'],['ğŸ ',S.scenes.filter(s=>s.ie==='INT').length,'INT'],['ğŸŒ³',S.scenes.filter(s=>s.ie==='EXT').length,'EXT'],['ğŸŒ™',S.scenes.filter(s=>s.tod==='NACHT').length,'Nacht']].map(([i,n,l])=>'<div class="card" style="text-align:center"><div style="font-size:18px">'+i+'</div><div style="font-size:22px;font-weight:700">'+n+'</div><div style="font-size:10px;opacity:0.5">'+l+'</div></div>').join('')}</div>
<div class="card"><h3 style="margin:0 0 12px;font-size:14px">Stripboard</h3>
<div style="overflow-x:auto">${S.scenes.length?S.scenes.map(s=>'<div style="display:flex;gap:8px;padding:8px;background:'+(s.ie==='INT'?'rgba(59,130,246,0.1)':'rgba(34,197,94,0.1)')+';border-radius:6px;margin-bottom:4px;align-items:center;font-size:12px"><span style="width:28px;font-weight:700;color:#dc2626">'+s.num+'</span><span style="width:36px;padding:2px 4px;background:'+(s.ie==='INT'?'#3b82f6':'#22c55e')+';border-radius:4px;font-size:9px;text-align:center">'+s.ie+'</span><span style="width:44px;padding:2px 4px;background:'+(s.tod==='NACHT'?'#1e1b4b':'#fef3c7')+';color:'+(s.tod==='NACHT'?'#fff':'#000')+';border-radius:4px;font-size:9px;text-align:center">'+(s.tod||'DAG')+'</span><span style="flex:1">'+s.loc+'</span><span style="opacity:0.5;font-size:10px">'+s.chars.slice(0,3).join(', ')+'</span></div>').join(''):'<p style="opacity:0.5;text-align:center;font-size:12px">Upload script eerst</p>'}</div></div>`;

const renderChat=()=>`<div style="display:flex;flex-direction:column;height:calc(100vh - 100px)"><h1 style="margin:0 0 12px">AI Regisseur</h1>
<div class="card" style="flex:1;display:flex;flex-direction:column;overflow:hidden;padding:0">
<div id="chatBox" style="flex:1;overflow-y:auto;padding:16px">${S.chatMessages.length===0?'<div style="text-align:center;padding:30px"><div style="font-size:40px;margin-bottom:12px">ğŸ¬</div><h3 style="font-size:14px">Vraag me alles!</h3><div style="display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin-top:16px">'+['Stanislavski?','Blocking?','Coverage?'].map(q=>'<button class="btn btn-ghost btn-sm" onclick="qChat(\''+q+'\')">'+q+'</button>').join('')+'</div></div>':S.chatMessages.map(m=>'<div style="display:flex;'+(m.role==='user'?'justify-content:flex-end;':'')+'margin-bottom:10px"><div style="max-width:85%;padding:10px 14px;border-radius:12px;'+(m.role==='user'?'background:rgba(220,38,38,0.2)':'background:rgba(139,92,246,0.1)')+'"><div style="white-space:pre-wrap;font-size:13px">'+m.content+'</div></div></div>').join('')+(S.isThinking?'<div style="opacity:0.5;font-size:12px">ğŸ¤– Denken...</div>':'')}</div>
<div style="padding:12px;border-top:1px solid rgba(255,255,255,0.1);display:flex;gap:8px"><input id="chatIn" class="input" style="flex:1;font-size:13px" placeholder="Vraag..." onkeypress="if(event.key==='Enter')sendChat()"><button class="btn btn-purple" onclick="sendChat()">Send</button></div></div></div>`;

const renderSettings=()=>`<div class="modal" onclick="S.showSettings=false;render()"><div class="modal-content" onclick="event.stopPropagation()"><h2 style="margin:0 0 16px;font-size:18px">âš™ï¸ Instellingen</h2><label style="font-size:12px;opacity:0.6">Claude API Key</label><input class="input" type="password" placeholder="sk-ant-..." value="${S.apiKey}" onchange="S.apiKey=this.value;save();render()" style="margin-top:6px"><p style="font-size:10px;opacity:0.4;margin-top:6px">console.anthropic.com</p><div style="margin-top:20px;display:flex;flex-direction:column;gap:8px"><button class="btn btn-ghost" onclick="exportProject()">ğŸ“¤ Export</button><button class="btn btn-ghost" onclick="importProject()">ğŸ“¥ Import</button></div><button class="btn btn-ghost" style="width:100%;margin-top:20px" onclick="S.showSettings=false;render()">Sluiten</button></div></div>`;

const renderNewProject=()=>`<div class="modal" onclick="S.showNewProject=false;render()"><div class="modal-content" onclick="event.stopPropagation()"><h2 style="margin:0 0 16px;font-size:18px">ğŸ¬ Nieuw Project</h2><input id="pName" class="input" placeholder="Naam..." style="margin-bottom:10px"><select id="pType" class="input"><option>Soap</option><option>Film</option><option>Serie</option><option>Commercial</option></select><button class="btn btn-red" style="width:100%;margin-top:16px" onclick="createProject()">ğŸš€ Start</button></div></div>`;

// HANDLERS
window.handleFile=function(e){
  console.log('handleFile aangeroepen');
  const f=e.target.files[0];
  if(!f){console.log('Geen file');return;}
  console.log('File:', f.name);
  const ext=f.name.split('.').pop().toLowerCase();
  if(ext==='docx'){
    const reader=new FileReader();
    reader.onload=async function(ev){
      try{
        console.log('DOCX laden...');
        const r=await mammoth.extractRawText({arrayBuffer:ev.target.result});
        console.log('DOCX geladen, tekst:', r.value.substring(0,100));
        S.scenes=parse(r.value);
        console.log('Scenes:', S.scenes.length);
        if(S.scenes.length>0)S.selectedScene=S.scenes[0];
        render();
      }catch(err){console.error(err);alert('DOCX fout: '+err.message);}
    };
    reader.readAsArrayBuffer(f);
  }else{
    const reader=new FileReader();
    reader.onload=function(ev){
      console.log('TXT geladen');
      S.scenes=parse(ev.target.result);
      console.log('Scenes:', S.scenes.length);
      if(S.scenes.length>0)S.selectedScene=S.scenes[0];
      render();
    };
    reader.readAsText(f);
  }
};
window.uploadScript=function(){
  console.log('uploadScript aangeroepen');
  const inp=document.createElement('input');
  inp.type='file';
  inp.accept='.txt,.docx';
  inp.onchange=function(e){handleFile(e);};
  inp.click();
};
window.parseTxt=()=>{const t=document.getElementById('scriptTxt')?.value;if(t){S.scenes=parse(t);if(S.scenes.length>0)S.selectedScene=S.scenes[0];render();}};
window.createProject=()=>{const n=document.getElementById('pName')?.value;if(!n){alert('Naam');return;}S.project={id:id(),name:n,type:document.getElementById('pType')?.value};S.showNewProject=false;render();};
window.genActing=async()=>{const sid=document.getElementById('aScene')?.value,ch=document.getElementById('aChar')?.value;if(!sid||!ch){alert('Selecteer beide');return;}const sc=S.scenes.find(s=>s.id===sid),m=M[S.method];S.isThinking=true;render();const r=await ai('Acteeraanwijzingen voor '+ch+' met '+m.n+' methode.\n\nMethode: '+m.d+'\nTechnieken: '+m.t.join(', ')+'\n\nScene:\n'+sc.txt);S.actingNotes.push({id:id(),char:ch,method:m.n,sceneId:sid,content:r});S.isThinking=false;render();};
window.deepDir=async n=>{S.isThinking=true;S.showDirector=null;S.tab='chat';render();const r=await ai('Analyse regisseur '+n+': visuele stijl, hoe met acteurs, editing, tips');S.chatMessages.push({role:'assistant',content:'ğŸ¬ '+n+':\n\n'+r});S.isThinking=false;render();};
window.sendChat=async()=>{const i=document.getElementById('chatIn'),m=i?.value?.trim();if(!m)return;S.chatMessages.push({role:'user',content:m});i.value='';S.isThinking=true;render();const ctx=S.selectedScene?'Context: Scene '+S.selectedScene.num+'\n\n':'';const r=await ai(ctx+m);S.chatMessages.push({role:'assistant',content:r});S.isThinking=false;render();setTimeout(()=>{const b=document.getElementById('chatBox');if(b)b.scrollTop=b.scrollHeight;},50);};
window.qChat=q=>{document.getElementById('chatIn').value=q;sendChat();};
window.addShot=()=>{if(!S.selectedScene){alert('Selecteer scene');return;}S.shots.push({id:id(),sceneId:S.selectedScene.id,size:document.getElementById('shotSize')?.value||'MS',angle:document.getElementById('shotAngle')?.value||'Eye Level',move:document.getElementById('shotMove')?.value||'Static',desc:document.getElementById('shotDesc')?.value||''});document.getElementById('shotDesc').value='';render();};
window.removeShot=i=>{S.shots.splice(i,1);render();};
window.exportShots=()=>{let csv='#,Scene,Size,Angle,Move,Desc\n';S.shots.forEach((sh,i)=>{const sc=S.scenes.find(s=>s.id===sh.sceneId);csv+=(i+1)+','+(sc?sc.num:'-')+','+sh.size+','+sh.angle+','+sh.move+',"'+sh.desc+'"\n';});const b=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='shotlist.csv';a.click();};
window.addBreakdownItem=cat=>{if(!S.selectedScene){alert('Selecteer scene');return;}const item=prompt(BREAKDOWN[cat].n+':');if(!item)return;if(!S.selectedScene.breakdown[cat])S.selectedScene.breakdown[cat]=[];S.selectedScene.breakdown[cat].push(item);render();};
window.aiBreakdown=async()=>{if(!S.selectedScene){alert('Selecteer scene');return;}S.isThinking=true;S.tab='chat';render();const r=await ai('Script breakdown voor scene:\n'+S.selectedScene.txt+'\n\nGeef per categorie: Cast, Figuranten, Props, Kostuums, Make-up, Voertuigen, SFX, Dieren, Muziek');S.chatMessages.push({role:'assistant',content:'ğŸ·ï¸ Breakdown:\n\n'+r});S.isThinking=false;render();};
window.aiDecoupage=async()=>{if(!S.selectedScene){alert('Selecteer scene');return;}S.isThinking=true;S.tab='chat';render();const r=await ai('Decoupage voor scene '+S.selectedScene.num+':\n'+S.selectedScene.txt+'\n\nGeef per shot: size, hoek, beweging, wat in beeld is');S.chatMessages.push({role:'assistant',content:'ğŸ¥ Decoupage:\n\n'+r});S.isThinking=false;render();};
window.aiShotlist=async()=>{S.isThinking=true;S.tab='chat';render();const r=await ai('Genereer shotlist voor '+S.scenes.length+' scenes. Coverage, master shots, close-ups.');S.chatMessages.push({role:'assistant',content:'ğŸ“‹ Shot List:\n\n'+r});S.isThinking=false;render();};
window.aiScene=async()=>{if(!S.selectedScene)return;S.isThinking=true;S.tab='chat';render();const r=await ai('Analyseer scene als regisseur:\n'+S.selectedScene.txt+'\n\nKern, emotionele beats, visuele aanpak, acteur tips');S.chatMessages.push({role:'assistant',content:'ğŸ¬ Analyse:\n\n'+r});S.isThinking=false;render();};
window.addStoryline=()=>{const name=prompt('Naam verhaallijn:');if(!name)return;const colors=['#ef4444','#f59e0b','#22c55e','#3b82f6','#8b5cf6','#ec4899'];S.storylines.push({id:id(),name,desc:'',priority:S.storylines.length===0?'A':S.storylines.length<3?'B':'C',color:colors[S.storylines.length%colors.length],scenes:[]});render();};
window.removeStoryline=i=>{S.storylines.splice(i,1);render();};
window.aiStorylines=async()=>{S.isThinking=true;S.tab='chat';render();const sceneTxt=S.scenes.map(s=>s.num+'. '+s.loc+': '+s.chars.join(', ')).join('\n');const r=await ai('Analyseer verhaallijnen. A, B, C-lijnen:\n'+sceneTxt);S.chatMessages.push({role:'assistant',content:'ğŸ“ˆ Verhaallijnen:\n\n'+r});S.isThinking=false;render();};
window.aiSchedule=async()=>{S.isThinking=true;S.tab='chat';render();const sceneTxt=S.scenes.map(s=>s.num+'. '+s.ie+' '+s.loc+' - '+(s.tod||'DAG')).join('\n');const r=await ai('Optimaliseer draaiboek. Groepeer op locatie, INT/EXT, dag/nacht:\n'+sceneTxt);S.chatMessages.push({role:'assistant',content:'ğŸ“… Draaiboek:\n\n'+r});S.isThinking=false;render();};
window.exportSchedule=()=>{let txt='DRAAIBOEK\n=========\n\n';S.scenes.forEach(s=>{txt+=s.num+'. '+s.ie+' '+s.loc+' - '+(s.tod||'DAG')+'\n   '+s.chars.join(', ')+'\n\n';});const b=new Blob([txt],{type:'text/plain'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='draaiboek.txt';a.click();};
window.aiMethodDeep=async k=>{const m=M[k];S.isThinking=true;S.showMethod=null;S.tab='chat';render();const r=await ai('Uitgebreide uitleg '+m.n+': oorsprong, principes, oefeningen, geschikt voor, valkuilen');S.chatMessages.push({role:'assistant',content:m.i+' '+m.n+':\n\n'+r});S.isThinking=false;render();};
window.exportProject=()=>{const data={project:S.project,scenes:S.scenes,shots:S.shots,storylines:S.storylines,actingNotes:S.actingNotes,setElements:S.setElements,cameraLines:S.cameraLines,method:S.method,chatMessages:S.chatMessages};const b=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='directorshub_'+(S.project?.name||'project')+'.json';a.click();S.showSettings=false;render();};
window.importProject=()=>{const i=document.createElement('input');i.type='file';i.accept='.json';i.onchange=async e=>{const d=JSON.parse(await e.target.files[0].text());Object.assign(S,d);S.showSettings=false;render();};i.click();};

// SET PLANNING
let ctx=null,drawing=false,start=null;
window.loadImg=e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{S.setImage=ev.target.result;render();};r.readAsDataURL(f);};
window.initCanvas=()=>{const c=document.getElementById('setCanvas');if(!c)return;ctx=c.getContext('2d');redraw();
  c.onmousedown=e=>{if(!S.drawMode)return;const rect=c.getBoundingClientRect();start={x:(e.clientX-rect.left)*(c.width/rect.width),y:(e.clientY-rect.top)*(c.height/rect.height)};drawing=true;};
  c.onmousemove=e=>{if(!drawing||!start)return;const rect=c.getBoundingClientRect();const x=(e.clientX-rect.left)*(c.width/rect.width),y=(e.clientY-rect.top)*(c.height/rect.height);redraw();ctx.beginPath();ctx.moveTo(start.x,start.y);ctx.lineTo(x,y);ctx.strokeStyle=S.drawMode==='line'?'#3b82f6':'#22c55e';ctx.lineWidth=3;ctx.setLineDash(S.drawMode==='move'?[10,5]:[]);ctx.stroke();};
  c.onmouseup=e=>{if(!drawing||!start)return;const rect=c.getBoundingClientRect();const x=(e.clientX-rect.left)*(c.width/rect.width),y=(e.clientY-rect.top)*(c.height/rect.height);S.cameraLines.push({x1:start.x,y1:start.y,x2:x,y2:y,type:S.drawMode});drawing=false;start=null;redraw();render();};
  c.ontouchstart=e=>{if(!S.drawMode)return;e.preventDefault();const rect=c.getBoundingClientRect();const t=e.touches[0];start={x:(t.clientX-rect.left)*(c.width/rect.width),y:(t.clientY-rect.top)*(c.height/rect.height)};drawing=true;};
  c.ontouchmove=e=>{if(!drawing||!start)return;e.preventDefault();const rect=c.getBoundingClientRect();const t=e.touches[0];const x=(t.clientX-rect.left)*(c.width/rect.width),y=(t.clientY-rect.top)*(c.height/rect.height);redraw();ctx.beginPath();ctx.moveTo(start.x,start.y);ctx.lineTo(x,y);ctx.strokeStyle=S.drawMode==='line'?'#3b82f6':'#22c55e';ctx.lineWidth=3;ctx.setLineDash(S.drawMode==='move'?[10,5]:[]);ctx.stroke();};
  c.ontouchend=()=>{drawing=false;start=null;};
};
window.redraw=()=>{const c=document.getElementById('setCanvas');if(!c||!ctx)return;ctx.clearRect(0,0,c.width,c.height);ctx.fillStyle='#1a1a2e';ctx.fillRect(0,0,c.width,c.height);
  // Grid
  ctx.strokeStyle='rgba(255,255,255,0.03)';ctx.lineWidth=1;
  for(let x=0;x<c.width;x+=40){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,c.height);ctx.stroke();}
  for(let y=0;y<c.height;y+=40){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(c.width,y);ctx.stroke();}
  if(S.setImage){const img=new Image();img.onload=()=>{const scale=Math.min(c.width/img.width,c.height/img.height)*0.9;const w=img.width*scale,h=img.height*scale;ctx.drawImage(img,(c.width-w)/2,(c.height-h)/2,w,h);drawEls();drawLines();};img.src=S.setImage;}else{drawEls();drawLines();}
};
window.drawEls=()=>{S.setElements.forEach(el=>{
  ctx.beginPath();ctx.arc(el.x,el.y,18,0,Math.PI*2);
  const colors={actor:'#ef4444',camera:'#3b82f6',light:'#eab308',prop:'#22c55e',mark:'#a855f7'};
  ctx.fillStyle=colors[el.type]||'#666';ctx.fill();
  ctx.strokeStyle='rgba(255,255,255,0.3)';ctx.lineWidth=2;ctx.stroke();
  const icons={actor:'ğŸ‘¤',camera:'ğŸ“¹',light:'ğŸ’¡',prop:'ğŸª‘',mark:'âœ–'};
  ctx.font='12px Arial';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(icons[el.type]||'â€¢',el.x,el.y);
  ctx.fillStyle='#fff';ctx.font='bold 10px Inter';ctx.fillText(el.name,el.x,el.y+32);
  if(el.type==='camera'){ctx.beginPath();ctx.moveTo(el.x,el.y);const a=el.angle||0,l=80;ctx.lineTo(el.x+Math.cos(a-0.4)*l,el.y+Math.sin(a-0.4)*l);ctx.lineTo(el.x+Math.cos(a+0.4)*l,el.y+Math.sin(a+0.4)*l);ctx.closePath();ctx.fillStyle='rgba(59,130,246,0.15)';ctx.fill();}
});};
window.drawLines=()=>{S.cameraLines.forEach(l=>{ctx.beginPath();ctx.moveTo(l.x1,l.y1);ctx.lineTo(l.x2,l.y2);ctx.strokeStyle=l.type==='line'?'#3b82f6':'#22c55e';ctx.lineWidth=3;ctx.setLineDash(l.type==='move'?[10,5]:[]);ctx.stroke();ctx.setLineDash([]);
  const a=Math.atan2(l.y2-l.y1,l.x2-l.x1);ctx.beginPath();ctx.moveTo(l.x2,l.y2);ctx.lineTo(l.x2-12*Math.cos(a-0.5),l.y2-12*Math.sin(a-0.5));ctx.lineTo(l.x2-12*Math.cos(a+0.5),l.y2-12*Math.sin(a+0.5));ctx.closePath();ctx.fillStyle=l.type==='line'?'#3b82f6':'#22c55e';ctx.fill();});};
window.addEl=t=>{const n=prompt(t.charAt(0).toUpperCase()+t.slice(1)+' naam:');if(!n)return;const c=document.getElementById('setCanvas');S.setElements.push({id:id(),type:t,name:n,x:c?c.width/2+Math.random()*80-40:350,y:c?c.height/2+Math.random()*80-40:225,angle:t==='camera'?-Math.PI/2:0});render();};
window.remEl=i=>{S.setElements.splice(i,1);render();};
window.setDraw=m=>{S.drawMode=S.drawMode===m?null:m;render();};
window.undoLine=()=>{S.cameraLines.pop();render();};
window.clearSet=()=>{if(!confirm('Wissen?'))return;S.setElements=[];S.cameraLines=[];S.setImage=null;render();};
window.pattern=p=>{const cx=350,cy=225;
if(p==='triangle'){S.setElements.push({id:id(),type:'actor',name:'A',x:cx,y:cy-60},{id:id(),type:'actor',name:'B',x:cx-80,y:cy+50},{id:id(),type:'actor',name:'C',x:cx+80,y:cy+50},{id:id(),type:'camera',name:'CAM',x:cx,y:cy+140,angle:-Math.PI/2});}
else if(p==='diagonal'){S.setElements.push({id:id(),type:'actor',name:'A',x:cx-100,y:cy-50},{id:id(),type:'actor',name:'B',x:cx+100,y:cy+50},{id:id(),type:'camera',name:'CAM',x:cx+160,y:cy-100,angle:Math.PI*0.75});}
else if(p==='ots'){S.setElements.push({id:id(),type:'actor',name:'A',x:cx-60,y:cy},{id:id(),type:'actor',name:'B',x:cx+60,y:cy},{id:id(),type:'camera',name:'OTS-A',x:cx+110,y:cy-70,angle:Math.PI*0.8},{id:id(),type:'camera',name:'OTS-B',x:cx-110,y:cy-70,angle:Math.PI*0.2});}
render();};
window.aiBlocking=async()=>{S.isThinking=true;S.tab='chat';render();const els=S.setElements.map(e=>e.type+':'+e.name).join(', ')||'geen';const r=await ai('Blocking tips voor: '+els+'. Geef CAMERA POSITIES, ACTOR BLOCKING, KIJKLIJNEN.');S.chatMessages.push({role:'assistant',content:'ğŸ—ºï¸ Blocking:\n\n'+r});S.isThinking=false;render();};


render();
</script>
</body>
</html>
